#!/bin/bash

echo "=== Go Experimental Features Setup Guide ==="
echo ""
echo "This guide shows how to properly enable experimental features in Go 1.25+"
echo ""

echo "1. Check your Go version:"
echo "   go version"
go version
echo ""

echo "2. Set the GOEXPERIMENT environment variable:"
echo "   export GOEXPERIMENT=greenteagc,jsonv2"
echo ""
echo "   This enables:"
echo "   - greenteagc: New garbage collector with improved pause times"
echo "   - jsonv2: Enhanced JSON processing (when using builtin packages)"
echo ""

echo "3. Verify the environment variable is set:"
echo "   echo \$GOEXPERIMENT"
echo ""

echo "4. Build or run your Go programs:"
echo "   GOEXPERIMENT=greenteagc,jsonv2 go build main.go"
echo "   GOEXPERIMENT=greenteagc,jsonv2 go run main.go"
echo ""

echo "5. Alternative: Set in your shell profile for persistent use:"
echo "   echo 'export GOEXPERIMENT=greenteagc,jsonv2' >> ~/.bashrc"
echo "   echo 'export GOEXPERIMENT=greenteagc,jsonv2' >> ~/.zshrc"
echo ""

echo "=== Available Experimental Features in Go 1.25+ ==="
echo ""
echo "GOEXPERIMENT=jsonv2"
echo "  - Enables enhanced JSON processing with better performance"
echo "  - Available packages: encoding/json/v2, encoding/json/jsontext"
echo "  - Substantial performance improvements for JSON operations"
echo ""
echo "GOEXPERIMENT=greenteagc"
echo "  - Enables new garbage collector implementation"
echo "  - Reduced GC pause times"
echo "  - Better memory utilization for large heaps"
echo "  - Improved performance for allocation-heavy workloads"
echo ""

echo "=== Important Notes ==="
echo ""
echo "- Experimental features are NOT covered by Go 1 compatibility promise"
echo "- APIs may change in future releases"
echo "- Test thoroughly before using in production"
echo "- Some experiments may have build issues or conflicts"
echo "- Provide feedback to the Go team to help improve implementations"
echo ""

echo "=== Running the Demos ==="
echo ""
echo "Run all demos with experimental features:"
echo "  GOEXPERIMENT=greenteagc,jsonv2 ./run_all_demos.sh"
echo ""
echo "Run individual demos:"
echo "  GOEXPERIMENT=greenteagc,jsonv2 go run main.go"
echo "  GOEXPERIMENT=greenteagc,jsonv2 go run gc_demo.go"
echo "  GOEXPERIMENT=greenteagc,jsonv2 go run benchmark.go"
echo ""

echo "Compare with default behavior:"
echo "  unset GOEXPERIMENT"
echo "  go run main.go"
echo "  go run gc_demo.go"