include:
  - local: /ops/pipelines/templates/common.yml
  - local: /ops/pipelines/templates/deploy.yml
  - local: /ops/pipelines/jobs/accessibility.yml

stages:
  - deploy
  - accessibility

# STAGING RELEASE ======================================================================================================

ui:staging:
  extends:
    - .job_template_deploy
  variables:
    RELEASE_NAME: ${CI_PROJECT_NAME}-ui
    HELM_PATH: ops/Helm/${CI_PROJECT_NAME}-ui
    REGISTRY: ${CI_REGISTRY_IMAGE}/ui-nuxt
    HELM_ARG: "--set serviceAccount.create=false"
  environment:
    name: yandex-staging
    url: staging.example.com
  only:
    refs:
      - /^(?:0|[1-9]\d*)\.(?:0|[1-9]\d*)\.(?:0|[1-9]\d*)-rc(?:0|[1-9]\d*)$/

# PRODUCTION RELEASE ===================================================================================================

ui:production:
  extends:
    - .job_template_deploy
  variables:
    RELEASE_NAME: ${CI_PROJECT_NAME}-ui
    HELM_PATH: ops/Helm/${CI_PROJECT_NAME}-ui
    REGISTRY: ${CI_REGISTRY_IMAGE}/ui-nuxt
    HELM_ARG: "--set serviceAccount.create=false"
  environment:
    name: yandex-production
    url: production.example.com
  only:
    refs:
      - /^(?:0|[1-9]\d*)\.(?:0|[1-9]\d*)\.(?:0|[1-9]\d*)\.?(?:0|[1-9]\d*)?$/
