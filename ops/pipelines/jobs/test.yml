include:
  - local: /ops/pipelines/templates/go.yml
  - template: Dependency-Scanning.gitlab-ci.yml
  - template: License-Scanning.gitlab-ci.yml

# ON COMMIT ============================================================================================================
gosec:
  extends:
    - .job_teplate_go
  before_script:
    - curl -sfL https://raw.githubusercontent.com/securego/gosec/master/install.sh | sh -s -- -b $GOPATH/bin v2.2.0
  script:
    - make gosec

gotest:
  extends:
    - .job_teplate_go
  coverage: '/coverage: \d+.\d+% of statements/'
  script:
    - make test

golint:
  extends:
    - .job_teplate_go
  image: golangci/golangci-lint:v1.24-alpine
  before_script:
    - apk add --update make
  script:
    - make golint

# Read more about this feature here: https://docs.gitlab.com/ee/user/application_security/license_compliance/
license_scanning:
  stage: test
  allow_failure: false
  rules:
    - if: $CI_COMMIT_TAG

dependency_scanning:
  stage: test
  only:
    - tags
