include:
  - local: /ops/pipelines/templates/deploy.yml

# COMMON TRIGGER RELEASE ===============================================================================================

trigger_deploy_ui:
  extends:
    - .job_template_deploy_staging
  trigger:
    include:
      - local: '/ops/pipelines/ui.yml'
    strategy: depend
  needs:
    - build:ui

# STAGING RELEASE ======================================================================================================

api:staging:
  extends:
    - .job_template_deploy_staging
  variables:
    RELEASE_NAME: ${CI_PROJECT_NAME}-api
    HELM_PATH: ops/Helm/${CI_PROJECT_NAME}-api
    REGISTRY: ${CI_REGISTRY_IMAGE}/api
  needs:
    - build:api

logger:staging:
  extends:
    - .job_template_deploy_staging
  variables:
    RELEASE_NAME: ${CI_PROJECT_NAME}-logger
    HELM_PATH: ops/Helm/${CI_PROJECT_NAME}-logger
    REGISTRY: ${CI_REGISTRY_IMAGE}/logger
    HELM_ARG: "--set serviceAccount.create=false"
  needs:
    - build:logger

# PRODUCTION RELEASE ===================================================================================================

api:production:
  extends:
    - .job_template_deploy_production
  variables:
    RELEASE_NAME: ${CI_PROJECT_NAME}-api
    HELM_PATH: ops/Helm/${CI_PROJECT_NAME}-api
    REGISTRY: ${CI_REGISTRY_IMAGE}/api
  needs:
    - build:api

logger:production:
  extends:
    - .job_template_deploy_production
  variables:
    RELEASE_NAME: ${CI_PROJECT_NAME}-logger
    HELM_PATH: ops/Helm/${CI_PROJECT_NAME}-logger
    REGISTRY: ${CI_REGISTRY_IMAGE}/logger
    HELM_ARG: "--set serviceAccount.create=false"
  needs:
    - build:logger
