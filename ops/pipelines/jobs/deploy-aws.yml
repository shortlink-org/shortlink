# AWS STAGING RELEASE ==================================================================================================
#aws:api-staging:
#  stage: deploy
#  variables:
#    RELEASE_NAME: ${CI_PROJECT_NAME}-api
#    HELM_PATH: ops/Helm/${CI_PROJECT_NAME}-api
#    REGISTRY: ${CI_REGISTRY_IMAGE}/api
#    HELM_ARG: '--set deploy.annotations.app\.gitlab\.com\/env=$ENVIRONMENT_NAME --set deploy.annotations.app\.gitlab\.com\/app=$CI_PROJECT_PATH_SLUG'
#
#    ENVIRONMENT_NAME: aws-staging-api
#    ENVIRONMENT_URL: http://example.com
#    K8S_NAMESPACE: staging
#  trigger:
#    include:
#      - local: 'ops/pipelines/deploy.yml'
#    strategy: depend
#  needs:
#    - trigger:build_api
##    - helm-lint-chart
##    - helm-run-chart
#  rules:
#    - if: '$CI_COMMIT_TAG =~ /^(?:0|[1-9]\d*)\.(?:0|[1-9]\d*)\.(?:0|[1-9]\d*)-rc(?:0|[1-9]\d*)$/'
#      when: on_success
#
#aws:logger-staging:
#  stage: deploy
#  variables:
#    RELEASE_NAME: ${CI_PROJECT_NAME}-logger
#    HELM_PATH: ops/Helm/${CI_PROJECT_NAME}-logger
#    REGISTRY: ${CI_REGISTRY_IMAGE}/logger
#    HELM_ARG: '--set serviceAccount.create=false --set deploy.annotations.app\.gitlab\.com\/env=$ENVIRONMENT_NAME --set deploy.annotations.app\.gitlab\.com\/app=$CI_PROJECT_PATH_SLUG'
#
#    ENVIRONMENT_NAME: aws-staging-logger
#    ENVIRONMENT_URL: http://example.com
#    K8S_NAMESPACE: staging
#  trigger:
#    include:
#      - local: 'ops/pipelines/deploy.yml'
#    strategy: depend
#  needs:
#    - trigger:build_logger
##    - helm-lint-chart
##    - helm-run-chart
#  rules:
#    - if: '$CI_COMMIT_TAG =~ /^(?:0|[1-9]\d*)\.(?:0|[1-9]\d*)\.(?:0|[1-9]\d*)-rc(?:0|[1-9]\d*)$/'
#      when: on_success

aws:ui-staging:
  stage: deploy
  variables:
    RELEASE_NAME: ${CI_PROJECT_NAME}-ui
    HELM_PATH: ops/Helm/${CI_PROJECT_NAME}-ui
    REGISTRY: ${CI_REGISTRY_IMAGE}/ui-nuxt
    HELM_ARG: '--set serviceAccount.create=false --set deploy.annotations.app\.gitlab\.com\/env=$ENVIRONMENT_NAME --set deploy.annotations.app\.gitlab\.com\/app=$CI_PROJECT_PATH_SLUG'

    ENVIRONMENT_NAME: aws-staging-ui
    ENVIRONMENT_URL: http://example.com
    K8S_NAMESPACE: staging
  trigger:
    include:
      - local: 'ops/pipelines/ui.yml'
    strategy: depend
  needs:
    - trigger:build_ui
#    - helm-lint-chart
#    - helm-run-chart
  rules:
    - if: '$CI_COMMIT_TAG =~ /^(?:0|[1-9]\d*)\.(?:0|[1-9]\d*)\.(?:0|[1-9]\d*)-rc(?:0|[1-9]\d*)$/'
      when: on_success
