include:
  - template: Verify/Browser-Performance.gitlab-ci.yml
  - template: Verify/Accessibility.gitlab-ci.yml
  - template: DAST.gitlab-ci.yml

# Read more about the feature here: https://docs.gitlab.com/ee/user/project/merge_requests/accessibility_testing.html
a11y:
  tags:
    - docker
  rules:
    - when: on_success

performance:
  stage: accessibility
  variables:
    URL: $ENVIRONMENT_URL
  tags:
    - docker
  allow_failure: true
  rules:
    - when: on_success

# Docs: https://gitlab.com/help/user/application_security/dast/index.md
dast:
  stage: accessibility
  variables:
    DAST_WEBSITE: $ENVIRONMENT_URL
    GITLAB_FEATURES: dast
  tags:
    - docker
  only:
    refs:
      - tags
      - branches
  when: on_success
