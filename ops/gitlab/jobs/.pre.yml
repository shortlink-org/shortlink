include:
  - local: /ops/gitlab/workflows/matrix_deploy.yml

# ANSIBLE ==============================================================================================================
ansible-up:
  stage: .pre
  when: manual
  image: quay.io/ansible/molecule:latest
  script:
    - make ansible-up

# TERRAFORM ============================================================================================================
terraform-up:
  stage: .pre
  trigger:
    include:
      - local: 'ops/gitlab/pipelines/terraform.yml'
    strategy: depend
  rules:
    - changes:
        - ops/terraform/*

# K8S ==================================================================================================================
ADDITIONAL_HELM:
  stage: .pre
  trigger:
    include:
      - local: 'ops/gitlab/pipelines/additional_helm.yml'
    strategy: depend
  rules:
    - when: manual
#    - if: $CI_COMMIT_TAG
#      when: manual

cert-manager:
  stage: .pre
  variables:
    RELEASE_NAME: cert-manager
    HELM_PATH: ops/Helm/addons/cert-manager
    HELM_NAMESPACE: cert-manager
  trigger:
    include:
      - local: 'ops/gitlab/pipelines/helm_deploy.yml'
    strategy: depend
  needs: []
  rules:
    - when: always
